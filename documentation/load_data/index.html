
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../manual_process/">
      
      
      <link rel="icon" href="../../assets/favicon_3.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Loading data - intracranial_ephys_utils</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-loading-functions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="intracranial_ephys_utils" class="md-header__button md-logo" aria-label="intracranial_ephys_utils" data-md-component="logo">
      
  <img src="../../assets/logo_3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            intracranial_ephys_utils
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Loading data
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="intracranial_ephys_utils" class="md-nav__button md-logo" aria-label="intracranial_ephys_utils" data-md-component="logo">
      
  <img src="../../assets/logo_3.png" alt="logo">

    </a>
    intracranial_ephys_utils
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intracranial_Ephys_Utils
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Loading data
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Loading data
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intracranial_ephys_utils.load_data" class="md-nav__link">
    <span class="md-ellipsis">
      load_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intracranial_ephys_utils.load_data.get_file_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_info
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intracranial_ephys_utils.load_data.read_file" class="md-nav__link">
    <span class="md-ellipsis">
      read_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intracranial_ephys_utils.load_data.get_event_times" class="md-nav__link">
    <span class="md-ellipsis">
      get_event_times
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intracranial_ephys_utils.load_data.missing_samples_check" class="md-nav__link">
    <span class="md-ellipsis">
      missing_samples_check
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intracranial_ephys_utils.load_data.read_task_ncs" class="md-nav__link">
    <span class="md-ellipsis">
      read_task_ncs
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manual_process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Look at data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocess/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Preprocessing data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plot data (left over)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<p>Here is some sample documentation. Let's start with the loading data script.</p>
<h1 id="data-loading-functions">Data Loading functions</h1>


<div class="doc doc-object doc-module">



<a id="intracranial_ephys_utils.load_data"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="intracranial_ephys_utils.load_data.get_file_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_file_info</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">file_extension</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Look in directory for files that start and end with something. Raise error if more than one match is found
Useful for neuralynx files where they may be multiple session, and file identifiers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the directory we want to look through.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>start prefix of desired file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_extension</code>
            </td>
            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>end suffix of desired file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>File_path</code></td>            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>first file path that matches</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">get_file_info</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()),</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span> <span class="c1"># grab the license from this repo</span>
<span class="go">PosixPath(&#39;/home/runner/work/intracranial_ephys_utils/intracranial_ephys_utils/LICENSE.txt&#39;)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>intracranial_ephys_utils/load_data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_file_info</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Look in directory for files that start and end with something. Raise error if more than one match is found</span>
<span class="sd">    Useful for neuralynx files where they may be multiple session, and file identifiers.</span>

<span class="sd">    Args:</span>
<span class="sd">        directory (Path):  Path to the directory we want to look through.</span>
<span class="sd">        start (string):  start prefix of desired file</span>
<span class="sd">        file_extension (string):  end suffix of desired file</span>

<span class="sd">    Returns:</span>
<span class="sd">        File_path: first file path that matches</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; get_file_info(Path(os.getcwd()), &#39;L&#39;, &#39;.txt&#39;) # grab the license from this repo</span>
<span class="sd">        PosixPath(&#39;/home/runner/work/intracranial_ephys_utils/intracranial_ephys_utils/LICENSE.txt&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">files_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_path</span> <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files_list</span> <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">file_extension</span><span class="p">)</span> <span class="ow">and</span>
             <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">start</span><span class="p">)]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found files: </span><span class="si">{</span><span class="n">files</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;More than one file matching </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">*</span><span class="si">{</span><span class="n">file_extension</span><span class="si">}</span><span class="s2">, consider a more specific function call.&quot;</span><span class="p">)</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">/</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">file_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="intracranial_ephys_utils.load_data.read_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Lazy reader of specific Neuralynx files. Will probably be removed eventually</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Absolute path to a neuralynx .ncs file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>reader_object</code></td>            <td>
                  <code><span title="neo.rawio.NeuralynxRawIO">NeuralynxRawIO</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>neo reader object for neuralynx data</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>intracranial_ephys_utils/load_data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NeuralynxRawIO</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lazy reader of specific Neuralynx files. Will probably be removed eventually</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (Path):  Absolute path to a neuralynx .ncs file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        reader_object: neo reader object for neuralynx data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stems</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">NeuralynxRawIO</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="n">stems</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">include_filenames</span><span class="o">=</span><span class="n">stems</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">reader</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="intracranial_ephys_utils.load_data.get_event_times" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_event_times</span><span class="p">(</span><span class="n">neuralynx_data_directory</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Looks at just the events file for a Neuralynx data directory to get timestamps(default is seconds) and labels
for recording events. This is useful if researcher of clinician manually annotated events while recording. Keep in
mind however, that the events file is sometimes not in accordance with the data itself, due to a referencing issue.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>neuralynx_data_directory</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory of Neuralynx data, that stores at least one .nev file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extension</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional(default None). If there are multiple .nev file, can specify the desired .nev by the end of the filename</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>event_times</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>machine time in microseconds. To convert this to seconds relative to recording start, convert to seconds and subtract from global_start</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>event_labels</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whatever the annotation was for each event.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>global_start</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Machine code time beginning of recording(seconds)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>event_file</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File name for events file (useful in case there are two events files)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>intracranial_ephys_utils/load_data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_event_times</span><span class="p">(</span><span class="n">neuralynx_data_directory</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Looks at just the events file for a Neuralynx data directory to get timestamps(default is seconds) and labels</span>
<span class="sd">    for recording events. This is useful if researcher of clinician manually annotated events while recording. Keep in</span>
<span class="sd">    mind however, that the events file is sometimes not in accordance with the data itself, due to a referencing issue.</span>

<span class="sd">    Args:</span>
<span class="sd">        neuralynx_data_directory (Path): Directory of Neuralynx data, that stores at least one .nev file</span>
<span class="sd">        extension: optional(default None). If there are multiple .nev file, can specify the desired .nev by the end of the filename</span>

<span class="sd">    Returns:</span>
<span class="sd">        event_times : machine time in microseconds. To convert this to seconds relative to recording start, convert to seconds and subtract from global_start</span>
<span class="sd">        event_labels : Whatever the annotation was for each event.</span>
<span class="sd">        global_start : Machine code time beginning of recording(seconds)</span>
<span class="sd">        event_file : File name for events file (useful in case there are two events files)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Obtained in seconds and assumes that the start of the file (not necessarily the task) is 0.</span>

    <span class="n">all_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">neuralynx_data_directory</span><span class="p">)</span>

    <span class="c1"># Find the events file, note just the filename, not the full path</span>
    <span class="k">if</span> <span class="n">extension</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">events_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_path</span> <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">all_files</span> <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Events&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nev&#39;</span><span class="p">)]</span>
        <span class="c1"># full_events_filepath = get_file_info(neuralynx_data_directory, &#39;Events&#39;, &#39;.nev&#39;)</span>
        <span class="c1"># events_file = full_events_filepath.name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">events_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_path</span> <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">all_files</span> <span class="k">if</span> <span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Events&#39;</span><span class="p">)</span> <span class="ow">and</span>
                                                                <span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">extension</span><span class="p">))]</span>
        <span class="c1"># full_events_filepath = get_file_info(neuralynx_data_directory, &#39;Events&#39;, extension)</span>
        <span class="c1"># events_file = full_events_filepath.name</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">events_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># with one events file, read in the photodiode file</span>
        <span class="n">events_file</span> <span class="o">=</span> <span class="n">events_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">event_reader</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">neuralynx_data_directory</span> <span class="o">/</span> <span class="n">events_file</span><span class="p">)</span>
        <span class="n">event_reader</span><span class="o">.</span><span class="n">parse_header</span><span class="p">()</span>

        <span class="n">ph_file</span> <span class="o">=</span> <span class="n">events_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.nev&quot;</span><span class="p">,</span> <span class="s2">&quot;.ncs&quot;</span><span class="p">)</span>
        <span class="n">ph_file</span> <span class="o">=</span> <span class="n">ph_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Events&quot;</span><span class="p">,</span> <span class="s2">&quot;photo1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">neuralynx_data_directory</span> <span class="o">/</span> <span class="n">ph_file</span><span class="p">):</span>
            <span class="n">ph_reader</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">neuralynx_data_directory</span> <span class="o">/</span> <span class="n">ph_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># pick other file by random</span>
            <span class="n">file_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">neuralynx_data_directory</span><span class="p">)</span>
            <span class="n">better_file_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.ncs&#39;</span><span class="p">)]</span>
            <span class="n">ph_reader</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">neuralynx_data_directory</span> <span class="o">/</span> <span class="n">better_file_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No photodiode file found. Using </span><span class="si">{</span><span class="n">better_file_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ph_reader</span><span class="o">.</span><span class="n">parse_header</span><span class="p">()</span>
            <span class="n">global_start</span> <span class="o">=</span> <span class="n">ph_reader</span><span class="o">.</span><span class="n">global_t_start</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;OSError. Inquire further. Previous errors were from a header missing information.&quot;</span><span class="p">)</span>
        <span class="c1"># global_start_event_reader = event_reader.global_t_start</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">event_times</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">event_labels</span> <span class="o">=</span> <span class="n">event_reader</span><span class="o">.</span><span class="n">get_event_timestamps</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;global_start&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                <span class="n">global_start</span> <span class="o">=</span> <span class="n">event_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No files to choose from. Is there neuralynx data in this folder?&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No events found&quot;</span><span class="p">)</span>
            <span class="n">event_times</span><span class="p">,</span> <span class="n">event_labels</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">ph_path</span> <span class="o">=</span> <span class="n">get_file_info</span><span class="p">(</span><span class="n">neuralynx_data_directory</span><span class="p">,</span> <span class="s2">&quot;photo&quot;</span><span class="p">,</span> <span class="s2">&quot;.ncs&quot;</span><span class="p">)</span>
            <span class="n">ph_reader</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">ph_path</span><span class="p">)</span>
            <span class="n">ph_reader</span><span class="o">.</span><span class="n">parse_header</span><span class="p">()</span>
            <span class="n">global_start</span> <span class="o">=</span> <span class="n">ph_reader</span><span class="o">.</span><span class="n">global_t_start</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">events_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No events file found, Using Photodiode file to get global machine time start&quot;</span><span class="p">)</span>
        <span class="n">event_times</span><span class="p">,</span> <span class="n">event_labels</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">ph_path</span> <span class="o">=</span> <span class="n">get_file_info</span><span class="p">(</span><span class="n">neuralynx_data_directory</span><span class="p">,</span> <span class="s2">&quot;photo&quot;</span><span class="p">,</span> <span class="s2">&quot;.ncs&quot;</span><span class="p">)</span>
        <span class="n">ph_reader</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">ph_path</span><span class="p">)</span>
        <span class="n">ph_reader</span><span class="o">.</span><span class="n">parse_header</span><span class="p">()</span>
        <span class="n">global_start</span> <span class="o">=</span> <span class="n">ph_reader</span><span class="o">.</span><span class="n">global_t_start</span>
        <span class="n">events_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found files: </span><span class="si">{</span><span class="n">events_files</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;More than one file matching </span><span class="si">{</span><span class="n">events_files</span><span class="si">}</span><span class="s2">, consider a more specific function call.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">event_times</span><span class="p">,</span> <span class="n">event_labels</span><span class="p">,</span> <span class="n">global_start</span><span class="p">,</span> <span class="n">events_file</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="intracranial_ephys_utils.load_data.missing_samples_check" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">missing_samples_check</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This script checks for missing samples in neuralynx files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path object where data file is.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>skipped_samples</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>integer number of skipped samples</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>t_starts</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start times for each segment</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>seg_sizes</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The lengths of each Neo segment</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>intracranial_ephys_utils/load_data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">missing_samples_check</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This script checks for missing samples in neuralynx files.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: Path object where data file is.</span>

<span class="sd">    Returns:</span>
<span class="sd">        skipped_samples: integer number of skipped samples</span>
<span class="sd">        t_starts: The start times for each segment</span>
<span class="sd">        seg_sizes: The lengths of each Neo segment</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_reader</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">file_reader</span><span class="o">.</span><span class="n">parse_header</span><span class="p">()</span>
    <span class="n">n_segments</span> <span class="o">=</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">_nb_segment</span>
    <span class="n">t_starts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">seg_sizes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sampling_rate</span> <span class="o">=</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">get_signal_sampling_rate</span><span class="p">()</span>
    <span class="n">skipped_samples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">diffs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Start of the last segment + size of last segment - start of the task according to event</span>
    <span class="c1"># ph_signal_estimate = file_reader.get_signal_t_start(block_index=0, seg_index=n_segments - 1) \</span>
    <span class="c1">#                      * sampling_rate + \</span>
    <span class="c1">#                      float(file_reader.get_signal_size(block_index=0, seg_index=n_segments - 1))</span>
    <span class="c1"># ph_signal = np.zeros((int(ph_signal_estimate), 1))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_segments</span><span class="p">):</span>
        <span class="n">t_start</span> <span class="o">=</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">get_signal_t_start</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seg_index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">seg_size</span> <span class="o">=</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">get_signal_size</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seg_index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="c1"># ph_signal_segment = file_reader.get_analogsignal_chunk(seg_index=i)</span>
        <span class="c1"># start_index = int(t_start * sampling_rate)</span>
        <span class="c1"># ph_signal[start_index:start_index + seg_size] = ph_signal_segment</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># This part of the script looks for missing samples</span>
            <span class="n">t_end</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">seg_sizes</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">sampling_rate</span><span class="p">)</span> <span class="o">+</span> <span class="n">t_starts</span><span class="p">[</span><span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t_start</span> <span class="o">-</span> <span class="n">t_end</span><span class="p">)</span> <span class="o">*</span> <span class="n">sampling_rate</span>
            <span class="n">skipped_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
            <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t_start</span> <span class="o">-</span> <span class="n">t_end</span><span class="p">))</span>
        <span class="n">t_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_start</span><span class="p">)</span>
        <span class="n">seg_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_size</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">skipped_samples</span><span class="p">,</span> <span class="n">t_starts</span><span class="p">,</span> <span class="n">seg_sizes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="intracranial_ephys_utils.load_data.read_task_ncs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_task_ncs</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">events_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interp_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read neuralynx data into an array, with sampling rate, and start time of the task.
To deal with discontinuities and dropped samples, we take a pragmatic approach. We assume continuous sampling, and
if there are inconsistencies between the number of samples in segments and the array itself, we fill in samples by
interpolating.
Ideally this spits out neuralynx data in the form of an array, with the sampling rate, and the start time of the task</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folder_name</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path object that tells the path of the structure</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filename we want to read currently</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>task</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(string, optional) that matches the event label in the actual events file. Ideally it matches the name of the task</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>events_file</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(path, optional) needed if task argument is provided, this used to be the .nev file, but I found it useless so now it's a csv file that I generate via the scripts in manual_process</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interp_type</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(string, optional) what type of interpolation to do in the case of missing data, choices are</p>
              </div>
            </td>
            <td>
                  <code>&#39;linear&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>linear or cubic, default is linear</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ncs_signal</code></td>            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ndarray - signal in the file in np array format</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>sampling_rate</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>sampling rate for signal</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>interp</code></td>            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ndarray - same size as ncs_signal and timestamps, tells you whether data was interpolated in that point, useful if finding weird things in data</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>timestamps</code></td>            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an array that gives the timestamps from the ncs file using the start and stop task segments,</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>this is in seconds, from the start of the .ncs file recording</p>


            <details class="quote">
              <summary>Source code in <code>intracranial_ephys_utils/load_data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_task_ncs</span><span class="p">(</span><span class="n">folder_name</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">events_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">interp_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read neuralynx data into an array, with sampling rate, and start time of the task.</span>
<span class="sd">    To deal with discontinuities and dropped samples, we take a pragmatic approach. We assume continuous sampling, and</span>
<span class="sd">    if there are inconsistencies between the number of samples in segments and the array itself, we fill in samples by</span>
<span class="sd">    interpolating.</span>
<span class="sd">    Ideally this spits out neuralynx data in the form of an array, with the sampling rate, and the start time of the task</span>

<span class="sd">    Args:</span>
<span class="sd">        folder_name: Path object that tells the path of the structure</span>
<span class="sd">        file: filename we want to read currently</span>
<span class="sd">        task: (string, optional) that matches the event label in the actual events file. Ideally it matches the name of the task</span>
<span class="sd">        events_file: (path, optional) needed if task argument is provided, this used to be the .nev file, but I found it useless so now it&#39;s a csv file that I generate via the scripts in manual_process</span>
<span class="sd">        interp_type: (string, optional) what type of interpolation to do in the case of missing data, choices are</span>
<span class="sd">    linear or cubic, default is linear</span>

<span class="sd">    Returns:</span>
<span class="sd">        ncs_signal: ndarray - signal in the file in np array format</span>
<span class="sd">        sampling_rate: sampling rate for signal</span>
<span class="sd">        interp: ndarray - same size as ncs_signal and timestamps, tells you whether data was interpolated in that point, useful if finding weird things in data</span>
<span class="sd">        timestamps: an array that gives the timestamps from the ncs file using the start and stop task segments,</span>
<span class="sd">    this is in seconds, from the start of the .ncs file recording</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_path</span> <span class="o">=</span> <span class="n">folder_name</span> <span class="o">/</span> <span class="n">file</span>
    <span class="n">ncs_reader</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">ncs_reader</span><span class="o">.</span><span class="n">parse_header</span><span class="p">()</span>
    <span class="n">n_segments</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">_nb_segment</span>
    <span class="n">sampling_rate</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">get_signal_sampling_rate</span><span class="p">()</span>

    <span class="c1"># This loop is to get around files that have weird events files, or task wasn&#39;t in the annotation</span>
    <span class="k">if</span> <span class="n">task</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">events_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need to provide event file&quot;</span><span class="p">)</span>
        <span class="n">labels_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">events_file</span><span class="p">)</span>
        <span class="n">task_label</span> <span class="o">=</span> <span class="n">labels_file</span><span class="p">[</span><span class="n">labels_file</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2"> duration&quot;</span><span class="p">]</span>
        <span class="n">task_start</span> <span class="o">=</span> <span class="n">task_label</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>  <span class="c1"># seconds from start of file</span>
        <span class="n">task_end</span> <span class="o">=</span> <span class="n">task_start</span> <span class="o">+</span> <span class="n">task_label</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># print(float(ncs_reader.get_signal_size(block_index=0, seg_index=n_segments - 1))/sampling_rate)</span>

        <span class="c1"># The following block looks for the time of the start and end of the task we care about</span>
        <span class="n">task_start_segment_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">task_end_segment_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">task_start_search</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_segments</span><span class="p">):</span>
            <span class="n">time_segment_start</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">get_signal_t_start</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seg_index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time_segment_start</span> <span class="o">&lt;</span> <span class="n">task_start</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">time_segment_start</span> <span class="o">&gt;=</span> <span class="n">task_start</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time_segment_start</span> <span class="o">&lt;</span> <span class="n">task_end</span><span class="p">):</span>
                <span class="c1"># The first time this is run, the task_start_search bit flips</span>
                <span class="k">if</span> <span class="n">task_start_search</span><span class="p">:</span>
                    <span class="n">task_start_search</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="c1"># We take the index before because time_segment_start may not overlap with the start of the segment</span>
                    <span class="c1"># and this is looking from below, so overlap is with previous segment</span>
                    <span class="n">task_start_segment_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">time_segment_start</span> <span class="o">&gt;</span> <span class="n">task_end</span><span class="p">:</span>
                <span class="c1"># The end isn&#39;t as important if we overshoot</span>
                <span class="n">task_end_segment_index</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">n_segments</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">task_end_segment_index</span> <span class="o">=</span> <span class="n">n_segments</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">task_start_segment_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">task_end_segment_index</span> <span class="o">=</span> <span class="n">n_segments</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">task_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">task_end</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ncs_reader</span><span class="o">.</span><span class="n">segment_t_stop</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seg_index</span><span class="o">=</span><span class="n">task_end_segment_index</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>

    <span class="c1"># I believe this is in number of seconds till start(if theoretically correct), the problem is that the sampling</span>
    <span class="c1"># rate is an average given to us by neuralynx</span>
    <span class="n">task_start_segment_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ncs_reader</span><span class="o">.</span><span class="n">get_signal_t_start</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                  <span class="n">seg_index</span><span class="o">=</span><span class="n">task_start_segment_index</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span> <span class="c1"># seconds</span>
    <span class="c1"># to be precise ignore a certain number of samples from task_start_segment_time</span>
    <span class="c1"># we should really only ever be 4 decimal place precise for up to 32K</span>
    <span class="n">task_start_segment_diff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">task_start</span> <span class="o">-</span> <span class="n">task_start_segment_time</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">sampling_rate</span><span class="p">)</span>  <span class="c1"># samples</span>

    <span class="c1"># to be precise ignore that last n samples past task_end</span>
    <span class="n">task_end_segment_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ncs_reader</span><span class="o">.</span><span class="n">segment_t_stop</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seg_index</span><span class="o">=</span><span class="n">task_end_segment_index</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">task_end_segment_diff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">task_end_segment_time</span><span class="o">-</span><span class="n">task_end</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">sampling_rate</span><span class="p">)</span>

    <span class="n">array_size</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">task_end</span><span class="o">-</span><span class="n">task_start</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">sampling_rate</span>
    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">task_start</span><span class="p">,</span> <span class="n">task_end</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">array_size</span><span class="p">))</span>
    <span class="n">interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">array_size</span><span class="p">),</span> <span class="p">))</span>
    <span class="n">ncs_signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">array_size</span><span class="p">),</span> <span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">task_start_segment_index</span><span class="p">,</span> <span class="n">task_end_segment_index</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># First stop. Get the time_segment_start and t_end for each segment.</span>
        <span class="n">time_segment_start</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">get_signal_t_start</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seg_index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">seg_size</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">get_signal_size</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seg_index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># samples</span>
        <span class="n">signal_segment</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">get_analogsignal_chunk</span><span class="p">(</span><span class="n">seg_index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">task_start_segment_index</span><span class="p">:</span>
            <span class="n">total_segment</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">rescale_signal_raw_to_float</span><span class="p">(</span><span class="n">signal_segment</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># get the segment size after discounting those starting samples</span>
            <span class="n">start_seg_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">seg_size</span> <span class="o">-</span> <span class="n">task_start_segment_diff</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">ncs_signal</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span> <span class="n">start_index</span><span class="o">+</span><span class="n">start_seg_size</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_segment</span><span class="p">[</span><span class="n">task_start_segment_diff</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">task_end_segment_index</span><span class="p">:</span>
            <span class="n">total_segment</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">rescale_signal_raw_to_float</span><span class="p">(</span><span class="n">signal_segment</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">end_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ncs_signal</span><span class="p">)</span>
            <span class="c1"># get the segment size after discounting the last samples past task_end</span>
            <span class="n">end_seg_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">seg_size</span> <span class="o">-</span> <span class="n">task_end_segment_diff</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">ncs_signal</span><span class="p">[</span><span class="n">end_index</span><span class="o">-</span><span class="n">end_seg_size</span><span class="p">:]</span> <span class="o">=</span> <span class="n">total_segment</span><span class="p">[:</span><span class="n">end_seg_size</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time_segment_start</span> <span class="o">-</span> <span class="n">task_start</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span>
                              <span class="n">sampling_rate</span><span class="p">)</span>
            <span class="c1"># rescale to uV</span>
            <span class="n">ncs_signal</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">start_index</span><span class="o">+</span><span class="n">seg_size</span><span class="p">]</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">rescale_signal_raw_to_float</span><span class="p">(</span><span class="n">signal_segment</span><span class="p">,</span>
                                                                                                  <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">task_start_segment_index</span><span class="p">:</span>
            <span class="n">previous_segment_stop</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">segment_t_stop</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seg_index</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">time_segment_start</span><span class="o">-</span><span class="n">previous_segment_stop</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="n">sampling_rate</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">time_segment_start</span><span class="o">-</span><span class="n">previous_segment_stop</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There is at least 10 seconds of missing data see below&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">previous_segment_stop</span><span class="p">,</span> <span class="n">time_segment_start</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="c1"># 01/18/2024 - Consider a version of this script that doesn&#39;t interpolate, to allow for better alignment</span>
                <span class="c1"># to spike data where this has in fact not been done (spike sorting (Osort) doesn&#39;t care about</span>
                <span class="c1"># timestamping at all)</span>
                <span class="n">previous_seg_signal</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">get_analogsignal_chunk</span><span class="p">(</span><span class="n">seg_index</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">previous_seg_signal_scaled</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">rescale_signal_raw_to_float</span><span class="p">(</span><span class="n">previous_seg_signal</span><span class="p">,</span>
                                                                                    <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">previous_seg_time_start</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">get_signal_t_start</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seg_index</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">previous_seg_size_samples</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">get_signal_size</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seg_index</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">curr_seg_time_end</span> <span class="o">=</span> <span class="n">ncs_reader</span><span class="o">.</span><span class="n">segment_t_stop</span><span class="p">(</span><span class="n">block_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seg_index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
                <span class="n">current_seg_signal_scaled</span> <span class="o">=</span> <span class="n">ncs_signal</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">start_index</span><span class="o">+</span><span class="n">seg_size</span><span class="p">]</span>
                <span class="n">data_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">previous_seg_signal_scaled</span><span class="p">,</span> <span class="n">current_seg_signal_scaled</span><span class="p">))</span>
                <span class="n">data_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">previous_seg_time_start</span><span class="p">,</span> <span class="n">previous_segment_stop</span><span class="p">,</span>
                                                     <span class="n">previous_seg_size_samples</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">time_segment_start</span><span class="p">,</span>
                                                                                             <span class="n">curr_seg_time_end</span><span class="p">,</span>
                                                                                             <span class="n">seg_size</span><span class="p">)))</span>

                <span class="c1"># how many missing samples</span>
                <span class="n">missing_samples_start_ind</span> <span class="o">=</span> <span class="n">previous_seg_size_samples</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">missing_samples_end_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">time_segment_start</span><span class="o">-</span><span class="n">previous_seg_time_start</span><span class="p">)</span><span class="o">*</span><span class="n">sampling_rate</span><span class="p">)</span>
                <span class="c1"># print(missing_samples_end)</span>
                <span class="n">missing_samples</span> <span class="o">=</span> <span class="n">missing_samples_end_ind</span><span class="o">-</span><span class="n">missing_samples_start_ind</span>
                <span class="c1"># Define a range around the missing samples</span>
                <span class="n">range_size</span> <span class="o">=</span> <span class="mi">100</span>

                <span class="c1"># Determine the sample indices for interpolation, 100 before and after the missing samples</span>
                <span class="n">interpolation_start_ind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">missing_samples_start_ind</span> <span class="o">-</span> <span class="n">range_size</span><span class="p">)</span>
                <span class="n">interpolation_end_ind</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_y</span><span class="p">),</span> <span class="n">missing_samples_end_ind</span> <span class="o">+</span> <span class="n">range_size</span><span class="p">)</span>
                <span class="c1"># Use only the surrounding data for interpolation</span>
                <span class="n">local_data_y</span> <span class="o">=</span> <span class="n">data_y</span><span class="p">[</span><span class="n">interpolation_start_ind</span><span class="p">:</span><span class="n">interpolation_end_ind</span><span class="p">]</span>
                <span class="n">local_data_t</span> <span class="o">=</span> <span class="n">data_t</span><span class="p">[</span><span class="n">interpolation_start_ind</span><span class="p">:</span><span class="n">interpolation_end_ind</span><span class="p">]</span>

                <span class="c1"># Create the interpolated data range over the missing sample range</span>
                <span class="n">interp_data_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">data_t</span><span class="p">[</span><span class="n">missing_samples_start_ind</span><span class="p">],</span> <span class="n">data_t</span><span class="p">[</span><span class="n">missing_samples_start_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
                                            <span class="n">missing_samples</span><span class="p">)</span>

                <span class="c1"># Select interpolation method based on the keyword</span>
                <span class="k">if</span> <span class="n">interp_type</span> <span class="o">==</span> <span class="s1">&#39;cubic&#39;</span><span class="p">:</span>
                    <span class="n">cs</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">local_data_t</span><span class="p">,</span> <span class="n">local_data_y</span><span class="p">)</span>
                    <span class="n">data_x_interp</span> <span class="o">=</span> <span class="n">cs</span><span class="p">(</span><span class="n">interp_data_t</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">interp_type</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
                    <span class="n">data_x_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">interp_data_t</span><span class="p">,</span> <span class="n">local_data_t</span><span class="p">,</span> <span class="n">local_data_y</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Interpolation not found.&#39;</span><span class="p">)</span>

                <span class="c1"># data fill in</span>
                <span class="n">ncs_signal</span><span class="p">[</span><span class="n">start_index</span><span class="o">-</span><span class="n">missing_samples</span><span class="p">:</span><span class="n">start_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_x_interp</span><span class="p">[:</span><span class="n">missing_samples</span><span class="p">]</span>
                <span class="n">interp</span><span class="p">[</span><span class="n">start_index</span><span class="o">-</span><span class="n">missing_samples</span><span class="p">:</span><span class="n">start_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">missing_samples_end_ind</span> <span class="o">-</span>
                                                                           <span class="n">missing_samples_start_ind</span><span class="p">,</span> <span class="p">))</span>
    <span class="k">return</span> <span class="n">ncs_signal</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="p">,</span> <span class="n">interp</span><span class="p">,</span> <span class="n">timestamps</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>